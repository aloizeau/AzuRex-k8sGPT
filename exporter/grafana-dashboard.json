{
  "dashboard": {
    "title": "K8sGPT - Analyse",
    "description": "Dashboard complet pour visualiser les issues K8sGPT et les actions de remédiation",
    "uid": "k8sgpt-analyzer-dashboard",
    "timezone": "browser",
    "refresh": "30s",
    "panels": [
      {
        "id": 1,
        "title": "Vue d'ensemble - Total des Issues",
        "type": "stat",
        "gridPos": { "h": 4, "w": 6, "x": 0, "y": 0 },
        "targets": [
          {
            "expr": "sum(k8sgpt_issues_total)",
            "legendFormat": "Total Issues"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": { "mode": "thresholds" },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                { "color": "green", "value": null },
                { "color": "yellow", "value": 5 },
                { "color": "red", "value": 10 }
              ]
            }
          }
        }
      },
      {
        "id": 2,
        "title": "Issues avec Remédiation Disponible",
        "type": "stat",
        "gridPos": { "h": 4, "w": 6, "x": 6, "y": 0 },
        "targets": [
          {
            "expr": "sum(k8sgpt_remediation_available)",
            "legendFormat": "Remédiations"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": { "mode": "palette-classic" }
          }
        }
      },
      {
        "id": 3,
        "title": "Dernière Analyse",
        "type": "stat",
        "gridPos": { "h": 4, "w": 6, "x": 12, "y": 0 },
        "targets": [
          {
            "expr": "k8sgpt_last_analysis_timestamp",
            "legendFormat": "Timestamp"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "dateTimeFromNow"
          }
        }
      },
      {
        "id": 4,
        "title": "Erreurs d'Analyse",
        "type": "stat",
        "gridPos": { "h": 4, "w": 6, "x": 18, "y": 0 },
        "targets": [
          {
            "expr": "rate(k8sgpt_analysis_errors_total[5m])",
            "legendFormat": "Erreurs/min"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": { "fixedColor": "red", "mode": "fixed" }
          }
        }
      },
      {
        "id": 5,
        "title": "Distribution des Issues par Sévérité",
        "type": "piechart",
        "gridPos": { "h": 8, "w": 8, "x": 0, "y": 4 },
        "targets": [
          {
            "expr": "sum by (severity) (k8sgpt_issues_by_severity)",
            "legendFormat": "{{severity}}"
          }
        ]
      },
      {
        "id": 6,
        "title": "Issues par Type de Ressource",
        "type": "bargauge",
        "gridPos": { "h": 8, "w": 8, "x": 8, "y": 4 },
        "targets": [
          {
            "expr": "sum by (kind) (k8sgpt_issues_by_kind)",
            "legendFormat": "{{kind}}"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": { "mode": "palette-classic" },
            "displayMode": "gradient",
            "orientation": "horizontal"
          }
        }
      },
      {
        "id": 7,
        "title": "Issues par Namespace",
        "type": "bargauge",
        "gridPos": { "h": 8, "w": 8, "x": 16, "y": 4 },
        "targets": [
          {
            "expr": "sum by (namespace) (k8sgpt_issues_total)",
            "legendFormat": "{{namespace}}"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": { "mode": "palette-classic" },
            "displayMode": "gradient",
            "orientation": "horizontal"
          }
        }
      },
      {
        "id": 8,
        "title": "Évolution des Issues dans le Temps",
        "type": "timeseries",
        "gridPos": { "h": 8, "w": 12, "x": 0, "y": 12 },
        "targets": [
          {
            "expr": "sum(k8sgpt_issues_total)",
            "legendFormat": "Total Issues"
          },
          {
            "expr": "sum(k8sgpt_remediation_available)",
            "legendFormat": "Avec Remédiation"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "lineInterpolation": "smooth",
              "lineWidth": 2,
              "fillOpacity": 10
            }
          }
        }
      },
      {
        "id": 9,
        "title": "Issues Critiques par Namespace",
        "type": "heatmap",
        "gridPos": { "h": 8, "w": 12, "x": 12, "y": 12 },
        "targets": [
          {
            "expr": "k8sgpt_issues_by_severity{severity=\"critical\"}",
            "legendFormat": "{{namespace}}"
          }
        ],
        "options": {
          "calculate": false,
          "cellGap": 1,
          "color": {
            "scheme": "Reds"
          }
        }
      },
      {
        "id": 10,
        "title": "Tableau des Issues Actives",
        "type": "table",
        "gridPos": { "h": 8, "w": 24, "x": 0, "y": 20 },
        "targets": [
          {
            "expr": "k8sgpt_issue_info",
            "format": "table",
            "instant": true
          }
        ],
        "transformations": [
          {
            "id": "labelsToFields",
            "options": {}
          }
        ],
        "fieldConfig": {
          "overrides": [
            {
              "matcher": { "id": "byName", "options": "severity" },
              "properties": [
                {
                  "id": "custom.displayMode",
                  "value": "color-background"
                },
                {
                  "id": "mappings",
                  "value": [
                    { "type": "value", "value": "critical", "color": "red" },
                    { "type": "value", "value": "warning", "color": "yellow" },
                    { "type": "value", "value": "info", "color": "green" }
                  ]
                }
              ]
            }
          ]
        }
      },
      {
        "id": 11,
        "title": "Alertes Recommandées",
        "type": "text",
        "gridPos": { "h": 6, "w": 12, "x": 0, "y": 28 },
        "options": {
          "mode": "markdown",
          "content": "## Alertes Prometheus Recommandées\n\n### Issues Critiques\n```yaml\nalert: K8sGPTCriticalIssues\nexpr: sum(k8sgpt_issues_by_severity{severity=\"critical\"}) > 0\nfor: 5m\n```\n\n### Trop d'Issues Sans Remédiation\n```yaml\nalert: K8sGPTNoRemediation\nexpr: (sum(k8sgpt_issues_total) - sum(k8sgpt_remediation_available)) > 10\nfor: 10m\n```"
        }
      },
      {
        "id": 12,
        "title": "Actions de Remédiation",
        "type": "text",
        "gridPos": { "h": 6, "w": 12, "x": 12, "y": 28 },
        "options": {
          "mode": "markdown",
          "content": "## Actions de Remédiation Automatisables\n\n- **OOMKilled**: Augmenter les limites mémoire\n- **CrashLoopBackOff**: Vérifier les logs et config\n- **NetworkPolicy**: Vérifier les labels\n- **PodDisruptionBudget**: Ajuster minAvailable\n- **ResourceQuota**: Augmenter les quotas namespace"
        }
      }
    ],
    "templating": {
      "list": [
        {
          "name": "namespace",
          "type": "query",
          "query": "label_values(k8sgpt_issues_total, namespace)",
          "multi": true,
          "includeAll": true,
          "current": {
            "text": "All",
            "value": "$__all"
          }
        },
        {
          "name": "severity",
          "type": "custom",
          "query": "critical,warning,info",
          "multi": true,
          "includeAll": true,
          "current": {
            "text": "All",
            "value": "$__all"
          }
        }
      ]
    }
  }
}
